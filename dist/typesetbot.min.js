"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],i=!0,s=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){s=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(s)throw r}}return n}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var TypesetBot=function t(e,n){_classCallCheck(this,t),this.logger=new TypesetBotLog(this),this.utils=new TypesetBotUtils(this),this.uuid=this.utils.create_UUID(),this.settings=new TypesetBotSettings(this,n),this.elementQuery=new TypesetBotElementQuery(this,e)},TypesetBotLog=function t(e){_classCallCheck(this,t),this.debug=!0,this.log=function(t){this.debug&&(console.log("TypesetBot: %s",t),"object"===_typeof(t)&&console.log(t))},this.warn=function(t){this.debug&&(console.warn("TypesetBot: %s",t),"object"===_typeof(t)&&console.warn(t))},this.error=function(t){console.error("TypesetBot: %s",t),"object"===_typeof(t)&&console.error(t)},this.start=function(t){this.debug&&(t in this._performanceMap||(this._performanceMap[t]=new TypesetBotPerformanceEntry),this._performanceMap[t].start.push(performance.now()))},this.end=function(t){this.debug&&(t in this._performanceMap||(this._performanceMap[t]=new TypesetBotPerformanceEntry),this._performanceMap[t].end.push(performance.now()))},this.diff=function(t){for(var e=0,n=0,i=this._performanceMap[t],s=0;s<i.start.length;s++)e+=i.start[s],n+=i.end[s];return(n-e).toFixed(2)+"ms --- (calls: "+i.start.length+")"},this._tsb=e,this._performanceMap={}},TypesetBotPerformanceEntry=function t(){_classCallCheck(this,t),this.start=[],this.end=[]},TypesetBotElementQuery=function t(e,n){_classCallCheck(this,t),this._queryString=null,this._index=0,this._nodeMap={},this.nodes=[],this.handleQuery=function(t){if(null!=t)if("string"!=typeof t){if("object"==_typeof(t)){if(NodeList.prototype.isPrototypeOf(t)){var e=t;console.log(e);var n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var a=r.value;this.nodes.push(a)}}catch(t){i=!0,s=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return}if(Node.prototype.isPrototypeOf(t))return console.log(t),void this.nodes.push(t)}this._tsb.logger.warn("Unknown type of query used.")}else{this._queryString=t;var l=document.querySelectorAll(t);console.log(l);var h=!0,u=!1,c=void 0;try{for(var f,y=l[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var p=f.value;this.nodes.push(p)}}catch(t){u=!0,c=t}finally{try{h||null==y.return||y.return()}finally{if(u)throw c}}}},this.updateElements=function(){null!=this._queryString?this.elems=document.querySelectorAll(this._queryString):this._tsb.logger.warn("Can not update elements without a query string.")},this.findTextInElements=function(t){var e=!0,n=!1,i=void 0;try{for(var s,r=t[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var o=s.value;this.findTextInElement(o)}}catch(t){n=!0,i=t}finally{try{e||null==r.return||r.return()}finally{if(n)throw i}}},this.findTextInElement=function(t){if(null==t.getAttribute("data-tsb-uuid")&&null==t.getAttribute("data-tsb-indexed")&&(t.setAttribute("data-tsb-uuid",this._tsb.uuid),t.setAttribute("data-tsb-indexed",this._index),this._nodeMap[this._index]=t,this._index+=1,"childNodes"in t)){var e=!0,n=!1,i=void 0;try{for(var s,r=t.childNodes[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var o=s.value;console.log(o),console.log(o.nodeType)}}catch(t){n=!0,i=t}finally{try{e||null==r.return||r.return()}finally{if(n)throw i}}}},this._tsb=e,this.handleQuery(n),this.findTextInElements(this.nodes)},TypesetBotSettings=function t(e,n){_classCallCheck(this,t),this._mergeSettings=function(t){if(null!=t)for(var e=0,n=Object.entries(t);e<n.length;e++){var i=_slicedToArray(n[e],2),s=i[0],r=i[1];void 0===this[s]&&this._tsb.logger.warn('Unknown settings key "'+s+'"'),this[s]=r}},this.alignment="justify",this.hyphenPenalty=50,this.hyphenPenaltyRagged=500,this.flagPenalty=3e3,this.fitnessClassDemerit=3e3,this.demeritOffset=1,this.loosenessParam=0,this.absoluteMaxRatio=5,this.maxRatio=2,this.minRatio=-1,this.hyphenLanguage="en-us",this.hyphenLeftMin=2,this.hyphenRightMin=2,this.fitnessClass=[-1,-.5,.5,1,1/0],this.spaceUnit="em",this.spaceWidth=1/3,this.spaceStretchability=1/6,this.spaceShrinkability=1/9,this.unwrapElements=["img"],this.dynamicWidth=!0,this.dynamicWidthIncrement=5,this.ratio=function(t,e,n,i,s){return e<t?(t-e)/((n-1)*s):(t-e)/((n-1)*i)},this.badness=function(t){return null==t||t<this.minRatio?1/0:100*Math.pow(Math.abs(t),3)+.5},this.demerit=function(t,e,n){var i=n?this.flagPenalty:0;return e>=0?Math.pow(this.demeritOffset+t+e,2)+i:e===-1/0?Math.pow(this.demeritOffset+t,2)+i:Math.pow(this.demeritOffset+t,2)-Math.pow(e,2)+i},this._tsb=e,this._customSettings=n,this._mergeSettings(n)},TypesetBotUtils=function t(e){_classCallCheck(this,t),this.create_UUID=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})},this._tsb=e};